SMG		EQU		P0
CS1		EQU		P1.1
CS2		EQU		P1.0
E		EQU		P1.5
DS18B20		EQU		P2.2
DS0		EQU		20H
DS1		EQU		21H
DS2		EQU		22H
DS3		EQU		23H
DS4		EQU		24H
DS5		EQU		25H
DS6		EQU		26H
DS7		EQU		27H
		ORG		00H
		AJMP		MAIN
		ORG		30H
MAIN:		MOV		R1,#0H
		MOV		R0,#DS0
		MOV		A,#0H
MD1:		MOV		@R0,A
		INC		R0
		INC		R1
		CJNE		R1,#9,MD1
		MOV		DS0,01H
MD2:		MOV		R5,#64H
MSS:		LCALL		MY
		DJNZ		R5,MSS
		LCALL		DS18B20WORK
		LCALL		BIN
		AJMP		MD2
MY:		MOV		DPTR,#TAB
		MOV		R0,#04
		MOV		R1,#DS0
		MOV		R2,#0FEH
MA:		MOV		A,@R1
		MOVC		A,@A+DPTR
		CJNE		R0,#02,MA1
		ANL		A,#07FH
MA1:		MOV		SMG,A
		INC		R1
		CLR		E
		CLR		CS1
		SETB		E
		SETB		CS1
		MOV		A,R2
		MOV		SMG,A
		RL		A
		MOV		R2,A
		CLR		E
		CLR		CS2
		SETB		E
		SETB		CS2
	   	LCALL		YS
		DJNZ		R0,MA
		MOV		SMG,#0FFH
		CLR		E
		CLR		CS2
		SETB		E
		SETB		CS2
		RET
YS:		MOV		R7,#15H
YS1:		MOV		R6,#30H
		DJNZ		R6,$
		DJNZ		R7,YS1
		RET
TAB:DB 0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H,0BFH
CS18B20:	CLR		DS18B20
		MOV		R0,#250
		DJNZ		R0,$
		SETB		DS18B20
		MOV		R0,#35
		DJNZ		R0,$
		JNB		DS18B20,$
		SETB		DS18B20
		MOV		R0,#50
		DJNZ		R0,$
		RET
E18B20:		MOV		B,#08H
E1:		RRC		A
		CLR		DS18B20
		NOP
		NOP
		NOP
		NOP
		NOP
		MOV		DS18B20,C
		MOV		R0,#28
		DJNZ		R0,$
		SETB		DS18B20
		DJNZ		B,E1
		RET
RD18B20:	MOV		B,#08H
		MOV		A,#00H
		CLR		C
RD1:		CLR		DS18B20
		NOP
		NOP
		NOP
		NOP
		NOP
		SETB		DS18B20
		MOV		C,DS18B20
		RRC		A
		MOV		R0,#23
		DJNZ		R0,$
		SETB		DS18B20
		DJNZ		B,RD1
		RET
DS18B20WORK:
		JNB		DS18B20,OUT
		LCALL		CS18B20
		MOV		A,#0CCH
		LCALL		E18B20
		MOV		A,#0BEH
		LCALL		E18B20
		LCALL		RD18B20
		MOV		B,A
		SWAP		A
		ANL		A,#0FH
		MOV		DS7,A
		MOV		A,B
		ANL		A,#0FH
		MOV		DS6,A
		LCALL		RD18B20
		RL		A
		RL		A
		RL		A
		RL		A
		ADD		A,DS7
		MOV		DS7,A
		LCALL		MY
		LCALL		MY
		LCALL		CS18B20
		MOV		A,#0CCH
		LCALL		E18B20
		MOV		A,#44H
		LCALL		E18B20
OUT:		RET
BIN:		MOV		A,DS7
		MOV		B,#100
		DIV		AB
		MOV		DS4,A
		MOV		A,#10
		XCH		A,B
		DIV		AB
		MOV		DS3,A
		MOV		DS2,B
		MOV		A,DS6
		MOV		DPTR,#TAB1
		MOVC		A,@A+DPTR
		MOV		B,#100
		DIV		AB
		MOV		A,#10
		XCH		A,B
		DIV		AB
		MOV		DS1,A
		MOV		DS0,B
		RET
TAB1:DB	00,06,13,19,25,31
     DB	38,44,50,56,62,69
     DB	75,81,88,94
		END