G1 G2 G3为三种颜色数量
G4为存储单元
光电1 2只检测无球报警
光纤检测三色球

;主要工作程序为63行

JRL	为工作指示灯
;工作主程序
TFRL:	CLR	JRL
	MOV	A,G1
	CJNE	A,#0,ZBQ
TF3:	MOV	A,G3
	CJNE	A,#0,ZHE
TF2:	MOV	A,G2
	CJNE	A,#0,ZHQ
	SETB	JRL
	AJMP	YSCX
;抓白球***************************************************
ZBQ:	LCALL	QGW2
	LCALL	S245
	JB	GX,ZB1
	LCALL	QGW3
	DEC	G1
	LCALL	RUN1
	AJMP	TFRL

ZB1:	LCALL	QGW1
	LCALL	S245
	JB	GX,TF3
	LCALL	QGW3
	DEC	G1
	LCALL	RUN1
	AJMP	TFRL
;抓黄球***************************************************
ZHQ:	LCALL	QGW2
	LCALL	S245
	JNB	GX,ZH1
	LCALL	ZJX
	MOV	A,G4
	CJNE	A,#2,ZH1
	LCALL	QGW3
	DEC	G2
	LCALL	RUN2
	AJMP	TFRL

ZH1:	LCALL	QGW1
	LCALL	S245
	JNB	GX,TFRL
	LCALL	ZJX
	MOV	A,G4
	CJNE	A,#2,TFRL
	LCALL	QGW3
	DEC	G2
	LCALL	RUN2
	AJMP	TFRL
;抓黑球***************************************************
ZHE:	LCALL	QGW2
	LCALL	S245
	JNB	GX,ZE1
	LCALL	ZJX
	MOV	A,G4
	CJNE	A,#1,ZE1
	LCALL	QGW3
	DEC	G3
	LCALL	RUN3
	AJMP	TFRL

ZE1:	LCALL	QGW1
	LCALL	S245
	JNB	GX,TF21
	LCALL	ZJX
	MOV	A,G4
	CJNE	A,#1,TF21
	LCALL	QGW3
	DEC	G3
	LCALL	RUN3
	AJMP	TFRL
TF21:	AJMP	TF2
;动作子程序***********************************************
QGW1:	LCALL	YYX
	LCALL	S245
	JB	GW1,QGW1
	SETB	YY
	LCALL	XYX
	LCALL	YS1S
	RET

QGW2:	LCALL	YYX
	LCALL	S245
	JNB	GW1,QW22
	JB	GW2,QGW2
	SETB	YY
	LCALL	XYX
	LCALL	YS1S
	RET
QW22:	LCALL	ZYX
	LCALL	S245
	JB	GW2,QW22
	SETB	ZY
	LCALL	XYX
	LCALL	YS1S
	RET

QGW3:	SETB	SK
	LCALL	SYX
QW3:	LCALL	ZYX
	LCALL	S245
	JB	GW3,QW3
	SETB	ZY
	CLR	SK
	RET
;复位*****************************************************
FW:	LCALL	SYX
FW0:	LCALL	S245
	JNB	GX,FW2
	JNB	GW2,FWC
	LCALL	YYX
	JB	GW1,FW0
FW1:	LCALL	ZYX
	LCALL	S245
	JB	GW2,FW1
FWC:	SETB	YY
	CLR	SK
	RET
FW2:	LCALL	ZYX
	LCALL	S245
	JB	GW3,FW2
	SETB	ZY
	CLR	SK
	AJMP	FW

ZYX:	CLR	ZY
	SETB	YY
	LCALL	MY
	RET
YYX:	CLR	YY
	SETB	ZY
	LCALL	MY
	RET
SYX:	SETB	SX
	LCALL	YS1S
	RET
XYX:	CLR	SX
	LCALL	YS1S
	LCALL	YS1S
	RET
;爪子颜色检测子程序***************************************
ZJX:	LCALL	YS1S
	LCALL	S245
	JNB	GX,ZJ1
ZJ0:	SETB	SK
	LCALL	S245
	JNB	GX,ZJ2
	JB	ZJW,ZJ0
	LCALL	YS1S
	LCALL	S245
	JNB	GX,ZJ3
	MOV	G4,#0
	CLR	SK
	RET

ZJ1:	MOV	G4,#3
	CLR	SK
	RET

ZJ2:	MOV	G4,#2
	CLR	SK
	RET

ZJ3:	MOV	G4,#1
	CLR	SK
	RET
;74LS245扩展子程序*****************************************
S245:	MOV	P0,#0FFH
	CLR	G
	MOV	21H,P0
	SETB	G
	RET