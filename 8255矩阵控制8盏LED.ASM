；输出：先发数，后判断
；出入：先判断，后发数
；MOVX	@DPTR,A 输出
；MOVX	A,@DPTR 输入

		ORG		00H
		AJMP		MAIN
		ORG		30H
MAIN:	
		LCALL		INIT_8255
		MOV		A,#0FFH
		LCALL		PDCH
		LCALL		PDB
MA:		
		MOV		A,#0FEH
		LCALL		PDCH
		LCALL		PDCL		
		JNB		ACC.4,LED1
		JNB		ACC.5,LED2
		JNB		ACC.6,LED3
		JNB		ACC.7,LED4
		MOV		A,#0FDH
		LCALL		PDCH
		LCALL		PDCL
		JNB		ACC.4,LED5
		JNB		ACC.5,LED6
		JNB		ACC.6,LED7
		JNB		ACC.7,LED8
		AJMP		MA
LED1:		MOV		A,#7FH
		LCALL		PDB
		AJMP		MAIN
LED2:		MOV		A,#0BFH
		LCALL		PDB
		AJMP		MAIN
LED3:		MOV		A,#0DFH
		LCALL		PDB
		AJMP		MAIN
LED4:		MOV		A,#0EFH                    
		LCALL		PDB
		AJMP		MAIN
LED5:		MOV		A,#0F7H
		LCALL		PDB
		AJMP		MAIN
LED6:		MOV		A,#0FBH
		LCALL		PDB
		AJMP		MAIN
LED7:		MOV		A,#0FDH
		LCALL		PDB
		AJMP		MAIN
LED8:		MOV		A,#0FEH
		LCALL		PDB
		AJMP		MAIN


INIT_8255: 
		LCALL		YS    
        	MOV     	DPTR,#7FFFH    
        	MOV     	A, #88H       
        	MOVX    	@DPTR,A    
	  	RET
PDCH:		MOV     	DPTR,#7EFFH   
		MOVX		@DPTR,A
	 	RET
PDCL:		MOV     	DPTR,#7EFFH   
		MOVX		A,@DPTR
		;MOV		20H,A(bit用)
		ANL		A,#0F0H
	 	RET
PDA:		MOV     	DPTR,#7CFFH   
		MOVX		@DPTR,A
	 	RET
PDB:		;MOV		A,20H（bit用）
		MOV     	DPTR,#7DFFH   
		MOVX		@DPTR,A
	 	RET
YS:     	MOV   		R5,#8
TM2:    	MOV   		R6,#250      
TM:    		MOV   		R7,#250
       		DJNZ  		R7,$
        	DJNZ  		R6,TM
        	DJNZ  		R5,TM2
        	RET
		END


ROW3	BIT		20H.4
ROW2	BIT		20H.5
ROW1	BIT		20H.6
ROW0	BIT		20H.7
COL3	BIT		20H.0
COL2	BIT		20H.1
COL1	BIT		20H.2
COL0	BIT		20H.3
D0	BIT		21H.0
D1	BIT		21H.1
D2	BIT		21H.2
D3	BIT		21H.3
D4	BIT		21H.4
D5	BIT		21H.5
D6	BIT		21H.6
D7	BIT		21H.7

ORG	00H
AJMP	MAIN
ORG	30H
MAIN:		MOV		SP,#80H
		LCALL		INIT_8255
		MOV		A,#0FFH
		LCALL		PDCH
		LCALL		PDB
		MOV		20H,#0FFH
		MOV		21H,#0FFH
		LCALL		PDB
		LCALL		PDCH
	

MA:		MOV		20H,#7FH
		LCALL		PDCH
		LCALL		PDCL
		JNB		COL3,M1
		MOV		20H,#0BFH
		LCALL		PDCH
		LCALL		PDCL
		JNB		COL3,M2
		MOV		20H,#0DFH
		LCALL		PDCH
		LCALL		PDCL
		JNB		COL3,M3
		MOV		20H,#0EFH
		LCALL		PDCH
		LCALL		PDCL
		JNB		COL3,M4
		AJMP		MA

		
M1:		LCALL		YS10MS
		CLR		ROW0
		LCALL		PDCH
		LCALL		PDCL
		JNB		COL3,M1
		MOV		21H,#0FFH
		CLR		D0
		LCALL		PDB
		AJMP		MA
M2:		LCALL		YS10MS
		CLR		ROW1
		LCALL		PDCH
		LCALL		PDCL
		JNB		COL3,M2
		MOV		21H,#0FFH
		CLR		D1
		LCALL		PDB
		AJMP		MA
M3:		LCALL		YS10MS
		CLR		ROW2
		LCALL		PDCH
		LCALL		PDCL
		JNB		COL3,M3
		MOV		21H,#0FFH
		CLR		D2
		LCALL		PDB
		AJMP		MA
M4:		LCALL		YS10MS
		CLR		ROW3
		LCALL		PDCH
		LCALL		PDCL
		JNB		COL3,M4
		MOV		21H,#0FFH
		CLR		D3
		LCALL		PDB
		AJMP		MA
INIT_8255:
		LCALL		YS
		MOV		DPTR,#3FFH
		MOV		A,#91H
		MOVX		@DPTR,A
		RET
PDCH:		MOV		A,20H
		MOV		DPTR,#2FFH
		MOVX		@DPTR,A
		RET
PDCL:		MOV		DPTR,#2FFH
		MOVX		A,@DPTR
		MOV		20H,A
		LCALL		YS10MS
		MOVX		A,@DPTR
		CJNE		A,20H,PDCL
		ANL		A,#0F0H
		RET
PDB:		MOV		A,21H
		MOV		DPTR,#1FFH
		MOVX		@DPTR,A
		RET
YS:		MOV		R5,#8
YS1:		MOV		R6,#250
YS2:		MOV		R7,#250
		DJNZ		R7,$
		DJNZ		R6,YS2
		DJNZ		R5,YS1
		RET
YS10MS:		MOV		R5,#100
YS3:		MOV		R6,#50
		DJNZ		R6,$
		DJNZ		R5,YS3
		RET
		END