工位1ds0  工位2ds1  工位3ds2
1白2黄3黑
光电只测白  光纤松开侧黄  抓紧测黑 否则无球

ZY	EQU	P1.0
YY	EQU	P1.1
ZJ	EQU	P1.2
SX	EQU	P1.3

GW1	BIT	21H.0
GW2	BIT	21H.1
GW3	BIT	21H.2
GX	BIT	21H.3
GD1	BIT	21H.4
GD2	BIT	21H.5

CS2	EQU	P2.0
CS1	EQU	P2.1
E	EQU	P2.4

DS0	EQU	30H
DS1	EQU	31H
DS2	EQU	32H
DS3	EQU	33H
DS4	EQU	34H
DS5	EQU	35H
DS6	EQU	36H
DS7	EQU	37H
G	EQU	P2.5
SMG	EQU	P0
	ORG	00H
	AJMP	MAIN
	ORG	30H
MAIN:	MOV	SP,#80H
	MOV	DS0,#0
	MOV	DS1,#0
	MOV	DS2,#0
	CLR	P2.6
	LCALL	MY
M0:	LCALL	FW
MAI:	LCALL	MY
	JB	P3.0,MAI
	LCALL	S245
	JNB	GD1,ZJ1
	JNB	GD2,ZJ2
M1:	LCALL	YYX
	LCALL	S245
	JB	GW2,M1
	SETB	YY
	LCALL	XYX
	LCALL	YS1S
	LCALL	S245
	JB	GX,ZJ0
	MOV	DS1,#2
	MOV	DS0,#3
	MOV	DS2,#1
	AJMP	ZJC
ZJ0:	CLR	ZJ
	LCALL	YS1S
	LCALL	S245
	JB	GX,MQ
	MOV	DS1,#3
	MOV	DS0,#2
	MOV	DS2,#1
	AJMP	ZJC
ZJ1:	MOV	DS0,#1
	LCALL	YYX
	LCALL	S245
	JB	GW2,ZJ1
	SETB	YY
	LCALL	XYX
	LCALL	YS1S
	LCALL	S245
	JB	GX,ZJ11
	MOV	DS1,#2
	MOV	DS2,#3
	AJMP	ZJC
MQ:	MOV	DS0,#0
	MOV	DS1,#0
	MOV	DS2,#0
	AJMP	M0

ZJ11:	CLR	ZJ
	LCALL	YS1S
	LCALL	S245
	JB	GX,MQ
	MOV	DS1,#3
	MOV	DS2,#2
	AJMP	ZJC

ZJ2:	MOV	DS1,#1
	LCALL	YYX
	LCALL	S245
	JB	GW1,ZJ2
	SETB	YY
	LCALL	XYX
	LCALL	YS1S
	LCALL	S245
	JB	GX,ZJ21
	MOV	DS0,#2
	MOV	DS2,#3
	AJMP	ZJC
ZJ21:	CLR	ZJ
	LCALL	YS1S
	LCALL	S245
	JB	GX,MQ
	MOV	DS0,#3
	MOV	DS2,#2
	AJMP	ZJC

ZJC:	LCALL	MY
	AJMP	M0

S245:	CLR	G
	MOV	21H,P0
	SETB	G
	RET
ZYX:	CLR	ZY
	SETB	YY
	LCALL	MY
	RET
YYX:	CLR	YY
	SETB	ZY
	LCALL	MY
	RET
SYX:	SETB	SX
	LCALL	YS1S
	LCALL	YS1S
	LCALL	YS1S
	RET
XYX:	CLR	SX
	LCALL	YS1S
	LCALL	YS1S
	LCALL	YS1S
	RET
YS1S:	MOV	B,#250
YS1:	LCALL	MY
	DJNZ	B,YS1
	RET
FW:	SETB	ZJ
	LCALL	SYX
FW1:	LCALL	S245
	JNB	GW3,FWC
	JNB	GW2,FW2
	LCALL	YYX
	LCALL	S245
	JB	GW1,FW1
FW2:	LCALL	ZYX
	LCALL	S245
	JB	GW3,FW2
FWC:	SETB	ZY
	SETB	YY
	RET




MY:	MOV	DPTR,#TAB
	MOV	R1,#DS0
	MOV	R2,#0FEH
MA:	MOV	A,@R1
	MOVC	A,@A+DPTR
	INC	R1
	MOV	SMG,A
	CLR	E
	CLR	CS1
	SETB	E
	SETB	CS1
	MOV	A,R2
	MOV	SMG,A
	RL	A
	MOV	R2,A
	CLR	E
	CLR	CS2
	SETB	E
	SETB	CS2
	LCALL	SMYS
	LCALL	SMQP
	CJNE	R1,#33H,MA
	RET
SMYS:	MOV	R3,#0FFH
	DJNZ	R3,$
SMQP:	MOV	SMG,#0FFH
	CLR	E
	CLR	CS1
	SETB	E
	SETB	CS1
	CLR	E
	CLR	CS2
	SETB	E
	SETB	CS2
	RET
TAB:DB	0C0H,0F9H,0A4H,0B0H,0FFH
	END
	