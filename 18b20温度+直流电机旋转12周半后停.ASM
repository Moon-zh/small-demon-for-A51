DJ	EQU	P1.0
DS18B20	EQU	P1.7
OUT	EQU	P1.6
CS2	EQU	P2.0
CS1	EQU	P2.1
E	EQU	P2.4

DS0	EQU	30H
DS1	EQU	31H
DS2	EQU	32H
DS3	EQU	33H
DS4	EQU	34H
DS5	EQU	35H
DS6	EQU	36H
DS7	EQU	37H
SMG	EQU	P0




	ORG	00H
	AJMP	MAIN
	ORG	30H
MAIN:	MOV	SP,#80H
	MOV	DS0,#10
	MOV	DS1,#10
	MOV	DS2,#10
	MOV	DS3,#10
	MOV	DS4,#10
	MOV	DS5,#0
	MOV	DS6,#0
	MOV	DS7,#0
MAI:
	LCALL	BIN
	LCALL	MY
	LCALL	DJCX
	AJMP	MAI

DJCX:	MOV	B,#8
DJ1:	LCALL	MY
	CLR	DJ
	JB	OUT,DJCX
DJ3:	LCALL	MY
	JNB	OUT,DJ3
	INC	DS5
	MOV	A,DS5
	CJNE	A,#10,DJ2
	MOV	DS5,#0
	INC	DS6
	MOV	A,DS6
	CJNE	A,#10,DJ1
	MOV	DS6,#0
	INC	DS7
	MOV	A,DS7
	CJNE	A,#1,DJ2
	SETB	DJ
	AJMP	$
 DJ2:	DJNZ	B,DJ1
	RET




CS18B20:	
	CLR	DS18B20
	MOV	R0,#250
	DJNZ	R0,$
	SETB	DS18B20
	MOV	R0,#35
	DJNZ	R0,$
	JNB	DS18B20,$
	RET
E18B20:MOV	B,#8
E1:	CLR	DS18B20
	RRC	A
	MOV	R0,#2
	DJNZ	R0,$
	MOV	DS18B20,C
	MOV	R0,#28
	DJNZ	R0,$
	SETB	DS18B20
	DJNZ	B,E1
	RET
RD18B20:MOV	B,#8
RD1:	CLR	DS18B20
	MOV	R0,#1
	DJNZ	R0,$
	SETB	DS18B20
	MOV	C,DS18B20
	RRC	A
	MOV	R0,#23
	DJNZ	R0,$
	DJNZ	B,RD1
	RET
BIN1:	LCALL	CS18B20
	MOV	A,#0CCH
	LCALL	E18B20
	RET
DS18B20WORK:
	JNB	DS18B20,OUT1
	LCALL	BIN1
	MOV	A,#0BEH
	LCALL	E18B20
	LCALL	RD18B20
	MOV	B,A
	SWAP	A
	ANL	A,#0FH
	MOV	39H,A
	MOV	A,B
	ANL	A,#0FH
	MOV	38H,A
	LCALL	RD18B20
	SWAP	A
	ADD	A,39H
	MOV	39H,A
	MOV	R0,#250
	DJNZ	R0,$
	LCALL	BIN1
	MOV	A,#44H
	LCALL	E18B20
OUT1:	RET
BIN:	LCALL	DS18B20WORK
	MOV	A,39H
	MOV	B,#10
	DIV	AB
	MOV	DS3,A
	MOV	DS2,B
	MOV	A,38H
	MOV	DPTR,#TAB1
	MOVC	A,@A+DPTR
	MOV	B,#10
	DIV	AB
	MOV	DS1,A
	MOV	DS0,B
	RET
TAB1:	DB	00,06,13,18,25,31
	DB	38,44,50,56,62,69
	DB	75,81,88,94








MY:	LCALL	BIN
	MOV	DPTR,#TAB
	MOV	R1,#DS0
	MOV	R2,#0FEH
MA:	MOV	A,@R1
	MOVC	A,@A+DPTR
	INC	R1
	MOV	SMG,A
	CLR	E
	CLR	CS1
	SETB	E
	SETB	CS1
	MOV	A,R2
	MOV	SMG,A
	RL	A
	MOV	R2,A
	CLR	E
	CLR	CS2
	SETB	E
	SETB	CS2
	LCALL	SMYS
	LCALL	SMQP
	CJNE	R1,#38H,MA
	RET
SMYS:	MOV	R3,#0FFH	
	DJNZ	R3,$
	RET
SMQP:	MOV	SMG,#0FFH
	CLR	E
	CLR	CS1
	SETB	E
	SETB	CS1
	CLR	E
	CLR	CS2
	SETB	E
	SETB	CS2
	RET
TAB:DB	0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H,0FFH	
	END




