RS		EQU		P1.0
RW		EQU		P1.1
E		EQU		P1.2
DS0		EQU		30H
DS1		EQU		31H
DS2		EQU		32H
DS3		EQU		33H
DS4		EQU		34H
DS5		EQU		35H
DS6		EQU		36H
DS7		EQU		37H
DS8		EQU		38H
DS9		EQU		39H
DS10	EQU		3AH
JSBZ	EQU		4AH
YD		EQU		60H
XD		EQU		61H
XJ		EQU		62H
ZS		EQU		63H
BZ		EQU		67H
TB1		EQU		64H
TB2		EQU		65H
ZSZJ	EQU		66H
CISHU	EQU		38H
CS1		EQU		P1.3
CS2		EQU		P1.4
EE		EQU		P1.5
SMG		EQU		P0
WE		EQU		P2.0
RW1		EQU		P2.1
RS11		EQU		P2.2


		ORG		00H
		AJMP	MAIN
		ORG		0BH
		AJMP	TIME
		ORG		30H
MAIN:	MOV		SP,#80H
		CLR		A
		CLR		E
		MOV		DS1,#0
		MOV		DS2,#0
		MOV		DS0,#0
		MOV		DS3,#0
		MOV		DS4,#0
		MOV		DS5,#10
		MOV		DS6,#0
		MOV		DS7,#0
		MOV		DS8,#10
		MOV		DS9,#0
		MOV		DS10,#0
		MOV		TMOD,#11H
		MOV		TL0,#3CH
		MOV		TH0,#0B0H
		SETB	EA
		SETB	TR0
		SETB	ET0
		
		LCALL	LCD_INIT2
		LCALL	YJCS

		LCALL	LCD_INIT
		
MAI:	MOV		A,#1
		LCALL	XIEZL
		MOV		A,#80H
		LCALL	XIEZL
		MOV		DPTR,#TABL1
		LCALL	XRWC
		MOV		A,#0c2H
		LCALL	XIEZL
		MOV		DPTR,#TABL3
		PUSH	ACC
		CLR		A
		MOVC	A,@A+DPTR
		LCALL	XIESJ
		POP		ACC
		MOV		A,#0C5H
		LCALL	XIEZL
		MOV		DPTR,#TABL3
		PUSH	ACC
		CLR		A
		MOVC	A,@A+DPTR
		LCALL	XIESJ
		POP		ACC
MAI1:	LCALL	MY
		MOV		A,#0C0H
		LCALL	XIEZL
		PUSH	ACC
		MOV		A,DS2
		MOV		B,#10
		DIV		AB
		ADD		A,#30H
		LCALL	XIESJ
		POP		ACC
		MOV		A,#0C1H
		LCALL	XIEZL
		PUSH	ACC
		MOV		A,B
		ADD		A,#30H
		LCALL	XIESJ
		POP		ACC	
		LCALL	MY
		MOV		A,#0C3H
		LCALL	XIEZL
		PUSH	ACC
		MOV		A,DS1
		MOV		B,#10
		DIV		AB
		ADD		A,#30H
		LCALL	XIESJ
		POP		ACC
		MOV		A,#0C4H
		LCALL	XIEZL
		PUSH	ACC
		MOV		A,B
		ADD		A,#30H
		LCALL	XIESJ
		POP		ACC
		LCALL	MY
		MOV		A,#0C6H
		LCALL	XIEZL
		PUSH	ACC
		MOV		A,DS0
		MOV		B,#10
		DIV		AB
		ADD		A,#30H
		LCALL	XIESJ
		POP		ACC
		MOV		A,#0C7H
		LCALL	XIEZL
		PUSH	ACC
		MOV		A,B
		ADD		A,#30H
		LCALL	XIESJ
		POP		ACC

		MOV		A,DS2
		CLR		C
		SUBB	A,#12
		JC		M3
M4:		MOV		A,#0C9H
		LCALL	XIEZL
		MOV		DPTR,#TABL4
		LCALL	XRWC
		AJMP	MAI1
M3:		MOV		A,DS2
		CLR		C
		SUBB	A,#0
		JC		M4
		MOV		A,#0C9H
		LCALL	XIEZL
		MOV		DPTR,#TABL5
		LCALL	XRWC
		AJMP	MAI1

TABL1:	DB	"TIME:",00H
TABL2:	DB	"0123456789",00H
TABL3:	DB	":",00H
TABL4:	DB	"PM",00H
TABL5:	DB	"AM",00H
TIME:	PUSH	ACC	
		PUSH	PSW
		INC		JSBZ
		MOV		A,JSBZ
		CJNE	A,#20,TIC
		MOV		JSBZ,#0
		INC		DS0
		MOV		A,DS0
		CJNE	A,#60,TIC
		MOV		DS0,#0
		INC		DS1
		MOV		A,DS1
		CJNE	A,#60,TIC
		MOV		DS1,#0
		INC		DS2
		MOV		A,DS2
		CJNE	A,#24,TIC
		MOV		DS2,#0


		
TIC:	MOV		TH0,#3CH
		MOV		TL0,#0B0H
		POP		PSW
		POP		ACC
		RETI
LCD_INIT:
		LCALL	YS5MS
		LCALL	YS5MS
		LCALL	YS5MS
		MOV		B,#3
IN1:	MOV		A,#3CH
		LCALL	XIEZL
		LCALL	YS5MS
		DJNZ	B,IN1
		MOV		A,#38H
		LCALL	XIEZL
		LCALL	YS5MS
		MOV		A,#0CH
		LCALL	XIEZL
		LCALL	YS5MS
		MOV		A,#1
		LCALL	XIEZL
		LCALL	YS5MS
		RET
XIEZL:	MOV		P0,A
		CLR		RS
		CLR		RW
		SETB	E
		LCALL	YS500MS
		CLR		E
		RET
XIESJ:	MOV		P0,A
		SETB	RS
		CLR		RW
		SETB	E
		LCALL	YS500MS
		CLR		E
		RET
XRWC:	PUSH	ACC
XR1:	CLR		A
		MOVC	A,@A+DPTR
		JZ		XRC
		INC		DPTR
		LCALL	XIESJ
		JMP		XR1
XRC:	POP		ACC
		RET
YS5MS:	MOV		R6,#10
Y51:	MOV		R7,#249
		DJNZ	R7,$
		DJNZ	R6,Y51
		RET
YS500MS:
		MOV		R5,#5
Y01:	MOV		R6,#100
		DJNZ	R6,$
		DJNZ	R5,Y01
		RET

MY:		MOV		DS5,#10
		MOV		DS8,#10
		MOV		A,DS0
		MOV		B,#10
		DIV		AB
		MOV		DS4,A
		MOV		DS3,B
		MOV		A,DS1
		MOV		B,#10
		DIV		AB
		MOV		DS7,A
		MOV		DS6,B
		MOV		A,DS2
		MOV		B,#10
		DIV		AB
		MOV		DS9,A
		MOV		DS10,B

		MOV		DPTR,#TAB
		MOV		R0,#8
		MOV		R1,#DS3
		MOV		R2,#0FEH
MA:		MOV		A,@R1
		MOVC		A,@A+DPTR
		MOV		SMG,A
		INC		R1
		CLR		EE
		CLR		CS1
		SETB		EE
		SETB		CS1
		MOV		A,R2
		MOV		SMG,A
		RL		A
		MOV		R2,A
		CLR		EE
		CLR		CS2
		SETB		EE
		SETB		CS2
		LCALL		SMYS
XY:		MOV		SMG,#0FFH
		CLR		EE
		CLR		CS1
		SETB		EE
		SETB		CS1
		CLR		EE
		CLR		CS2
		SETB		EE
		SETB		CS2
		DJNZ		R0,MA
		RET
SMYS:	MOV		R3,#40
SMYS1:	MOV		R4,#10
		DJNZ		R4,$
		DJNZ		R3,SMYS1
		RET

YJCS:	MOV		DPTR,#TABSZ
		MOV		YD,#48H
		MOV		XD,#0BBH
		MOV		TB1,#0
		MOV		TB2,#16
		MOV		CISHU,#16
		MOV		ZS,#3
		CLR		CS2
		SETB	CS1
		LCALL	XIECX
		MOV		DPTR,#TABSZ2
		MOV		YD,#49H
		MOV		XD,#0BBH
		MOV		TB1,#0
		MOV		TB2,#16
		MOV		CISHU,#16
		MOV		ZS,#3
		CLR		CS1
		SETB	CS2
		LCALL	XIECX

		MOV		DPTR,#TABS
		MOV		YD,#78H
		MOV		XD,#0BBH
		MOV		TB1,#0
		MOV		TB2,#16
		MOV		CISHU,#8
		MOV		ZS,#1
		CLR		CS2
		SETB	CS1
		LCALL	XIECX
		
		MOV		YD,#40H
		MOV		XD,#0BBH
		MOV		TB1,#8
		MOV		TB2,#16
		MOV		CISHU,#8
		MOV		ZS,#1
		CLR		CS1
		SETB	CS2
		LCALL	XIECX
		RET


XIECX:		MOV		BZ,#0
		MOV		39H,TB1	
		MOV		A,#0C0H
		LCALL		XIEZL1
		MOV		XJ,#2
		MOV		50H,XJ
		MOV		40H,#1
		MOV		ZSZJ,ZS
TU1:		MOV		A,XD
		LCALL		XIEZL1
		MOV		A,YD
		LCALL		XIEZL1
		MOV		51H,CISHU
TU2:		MOV		A,TB1
		MOVC		A,@A+DPTR
		INC		TB1
		LCALL		XIESJ1
		DJNZ		51H,TU2
		MOV		A,ZS
		CJNE		A,#1,TU3
		AJMP		TU4
TU3:		MOV		A,50H
		MOV		B,40H
		MUL		AB
		ADD		A,BZ
		MOV		B,CISHU
		MUL		AB
		ADD		A,39H
		MOV		TB1,A
TU4:		MOV		51H,CISHU
		INC		40H
		DJNZ		ZSZJ,TU2
		INC		XD
		MOV		40H,#1
		MOV		ZSZJ,ZS
		INC		BZ
		MOV		A,BZ
		MOV		B,TB2
		MUL		AB
		ADD		A,39H
		MOV		TB1,A
		DJNZ		XJ,TU1
		RET
LCD_INIT2:
		SETB		CS1
		CLR		CS2
		MOV		A,#3FH
		LCALL		XIEZL1
		LCALL		QP
		CLR		CS1
		SETB		CS2
		MOV		A,#3FH
		LCALL		XIEZL1
		LCALL		QP
		RET

QP:		MOV		XJ,#8
		MOV		XD,#0B8H
QP1:		MOV		A,XD
		LCALL		XIEZL1
		MOV		A,#40H
		LCALL		XIEZL1	
		MOV		CISHU,#64
QP2:		MOV		A,#0H
		LCALL		XIESJ1
		DJNZ		CISHU,QP2
		INC		XD
		DJNZ		XJ,QP1
		RET

XIEZL1:	CLR		WE
		CLR		RW1
		CLR		RS11
		MOV		P0,A
		SETB		WE
		CLR		WE
		RET

XIESJ1:		CLR		WE
		CLR		RW1
		SETB		RS11
		MOV		P0,A
		SETB		WE
		CLR		WE	
		RET
TAB:DB	0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H,0BFH

TABSZ:
;--  文字:  2  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,070H,008H,008H,008H,088H,070H,000H,000H,000H,000H,000H,000H,000H,000H,000H
DB  000H,030H,028H,024H,022H,021H,030H,000H,000H,000H,000H,000H,000H,000H,000H,000H

;--  文字:  4  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,000H,0C0H,020H,010H,0F8H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H
DB  000H,007H,004H,024H,024H,03FH,024H,000H,000H,000H,000H,000H,000H,000H,000H,000H

DB	;--  文字:  小  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,000H,000H,0C0H,070H,020H,000H,0FFH,000H,010H,020H,0C0H,080H,000H,000H,000H
DB  004H,002H,001H,000H,000H,040H,080H,07FH,000H,000H,000H,000H,001H,007H,002H,000H
tabs:
;--  文字:  时  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,0FCH,044H,044H,044H,0FCH,010H,090H,010H,010H,010H,0FFH,010H,010H,010H,000H
DB  000H,007H,004H,004H,004H,007H,000H,000H,003H,040H,080H,07FH,000H,000H,000H,000H


	
TABSZ2:;--  文字:  钟  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  040H,030H,02CH,0EBH,028H,028H,000H,0F8H,008H,008H,0FFH,008H,008H,0F8H,000H,000H
DB	001H,001H,001H,0FFH,041H,021H,000H,001H,001H,001H,0FFH,001H,001H,001H,000H,000H
;--  文字:  程  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  010H,012H,0D2H,0FEH,091H,011H,080H,0BFH,0A1H,0A1H,0A1H,0A1H,0BFH,080H,000H,000H
DB  004H,003H,000H,0FFH,000H,041H,044H,044H,044H,07FH,044H,044H,044H,044H,040H,000H

;--  文字:  序  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,000H,0FCH,004H,004H,014H,014H,035H,056H,094H,054H,034H,014H,004H,004H,000H
DB  080H,060H,01FH,000H,001H,001H,001H,041H,081H,07FH,001H,001H,001H,003H,001H,000H




		END