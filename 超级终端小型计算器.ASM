AJ	EQU	P1
C0	EQU	P1.3
C1	EQU	P1.2
C2	EQU	P1.1
C3	EQU	P1.0	

	ORG	00H
	AJMP	MAIN
	ORG	0BH
	AJMP	ZD
	ORG	00H
MAIN:	MOV	SP,#80H
	MOV	TMOD,#21H
	MOV	TH1,#0FDH;波特率9600
	MOV	TL1,#0FDH
	MOV	SCON,#50H
	SETB	TR0
	SETB	TR1
	SETB	ET0
	SETB	EA
	MOV	A,#12	;清屏
	LCALL	FS

MAI:	LCALL	AJPD
	AJMP	MAI

AJPD:	MOV	AJ,#7FH
	MOV	70H,#0
	JNB	C0,AJC
	INC	70H
	JNB	C1,AJC
	INC	70H
	JNB	C2,AJC
	INC	70H
	JNB	C3,AJC
	MOV	AJ,#0BFH
	INC	70H
	JNB	C0,AJC
	INC	70H
	JNB	C1,AJC
	INC	70H
	JNB	C2,AJC
	INC	70H
	JNB	C3,AJC
	MOV	AJ,#0DFH
	INC	70H
	JNB	C0,AJC
	INC	70H
	JNB	C1,AJC
	CLR	EA
	JNB	C2,J
	JNB	C3,JJ
	MOV	AJ,#0EFH
	JNB	C0,XX
	JNB	C1,CCC
	JNB	C2,DD
	RET

;##############################
;功能键程序
J:	LCALL	SSCX
	MOV	A,#"+"
	LCALL	FS
	RET
JJ:	LCALL	SSCX
	MOV	A,#"-"
	LCALL	FS
	RET
XX:	LCALL	SSCX
	MOV	A,#"*"
	LCALL	FS
	RET
CCC:	LCALL	SSCX
	MOV	A,#"/"
	LCALL	FS
	RET
DD:	LCALL	SSCX
	MOV	A,#"="
	LCALL	FS
	RET

AJC:	CLR	EA
	LCALL	SSCX
	MOV	A,70H
	ADD	A,#30H
	LCALL	FS
	SETB	EA
	RET

SSCX:	MOV	R0,#250	;松手
	DJNZ	R0,$
	MOV	AJ,#0FH
	JNB	C0,SSCX
	JNB	C1,SSCX
	JNB	C2,SSCX
	JNB	C3,SSCX
	MOV	R0,#250
	DJNZ	R0,$
	MOV	AJ,#0FFH
	RET

FS:	MOV	SBUF,A	;发送子程序
	JNB	TI,$
	CLR	TI
	RET

FSQ:	CLR	A	;发表共用程序
	MOVC	A,@A+DPTR
	JZ	FSC
	INC	DPTR
	LCALL	FS
	AJMP	FSQ
FSC:	RET

SY:	MOV	DPTR,#TABS;光标上移
	LCALL	FSQ
	RET
XY:	MOV	DPTR,#TABX;光标下移
	LCALL	FSQ
	RET
ZY:	MOV	DPTR,#TABZ;光标左移
	LCALL	FSQ
	RET
YY:	MOV	DPTR,#TABY;光标右移
	LCALL	FSQ
	RET

SYX:	JNB	C1,SYX
	LCALL	SY
	AJMP	ZD1

XYX:	JNB	C1,$
	LCALL	XY
	AJMP	ZD1

ZYX:	JNB	C0,$
	LCALL	ZY
	AJMP	ZD1

YYX:	JNB	C2,$
	LCALL	YY
	AJMP	ZD1

FXJ:	MOV	AJ,#7FH	;多功能键程序
	JNB	C1,SYX
	MOV	AJ,#0BFH
	JNB	C0,ZYX
	JNB	C2,YYX
	MOV	AJ,#0DFH
	JNB	C1,XYX
	AJMP	FXJ

ZD:	PUSH	ACC
	PUSH	PSW
	MOV	AJ,#0EFH;按下切换按键功能
	JNB	C3,FXJ

ZDC:	POP	PSW
	POP	ACC
	RETI
	END