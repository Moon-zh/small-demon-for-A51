CS2	EQU	P2.0
CS1	EQU	P2.1
E	EQU	P2.4
SMG	EQU	P0

DS0	EQU	30H
DS1	EQU	31H
DS2	EQU	32H
DS3	EQU	33H
DS4	EQU	34H
DS5	EQU	35H
DS6	EQU	36H
DS7	EQU	37H
DBZ	EQU	20H.0

AJ	EQU	P0
C0	EQU	P0.3
C1	EQU	P0.2
C2	EQU	P0.1
C3	EQU	P0.0

CP	EQU	P3.5
DIR	EQU	P3.6
PRO	EQU	P3.7


AXBZ	EQU	20H.1
AJBZ	EQU	39H
SMBZ	EQU	3AH

	ORG	00H
	AJMP	MAIN
	ORG	30H
MAIN:	MOV	SP,#80H
	CLR	DBZ
	MOV	SMBZ,#0
	MOV	AJBZ,#0
	MOV	DS0,#0
	MOV	DS1,#10
	MOV	DS2,#10
	MOV	DS3,#10
	MOV	DS4,#10
	MOV	DS5,#10
	MOV	DS6,#10
	MOV	DS7,#10
	LCALL	BJDJ
MAI:	LCALL	MY
	LCALL	AJPD
	MOV	AJ,#0DFH
	JNB	C3,KSYX
	JNB	AXBZ,MAI
	LCALL	SMYD
	AJMP	MAI
KSYX:	
PDSZ:	PUSH	SMBZ	(判断步进电机移动距离)
	INC	SMBZ
	MOV	R0,SMBZ
	MOV	A,@R0
	MOV	B,#10
	MUL	AB
	POP	SMBZ
	MOV	R0,SMBZ
	ADD	A,@R0
	MOV	B,#10
	MUL	AB
	MOV	R5,A
	LCALL	RUN
	DEC	SMBZ
	MOV	R0,SMBZ
	MOV	A,@R0
	MOV	R5,A
	LCALL	RUN
	AJMP	$
	

BJDJ:	SETB	DIR
	CPL	CP
	LCALL	MY
	JNB	PRO,BJDJ
	CLR	DIR
	MOV	R4,#92H
BJ1:	CPL	CP
	LCALL	MY
	DJNZ	R4,BJ1
	RET
RUN:	
CW1:	MOV	R6,#11H
CW2:	CPL	CP
	LCALL	MY
	DJNZ	R6,CW2
	DJNZ	R5,CW1
	RET


SMYD:	MOV	A,DS0	(SMG移动显示)
	MOV	R1,#DS1 
	MOV	B,#7
SM12:	XCH	A,@R1
	INC	R1
	DJNZ	B,SM12
	MOV	DS0,AJBZ
	JNB	DBZ,SM13
	INC	SMBZ
	MOV	A,SMBZ
	CJNE	A,#8,SM13
	MOV	SMBZ,#DS0
SM13:	RET
AJPD:	MOV	AJ,#7FH
	JNB	C0,AJ1
	JNB	C1,AJ2
	JNB	C2,AJ3
	JNB	C3,AJ4
	MOV	AJ,#0BFH
	JNB	C0,AJ5
	JNB	C1,AJ6
	JNB	C2,AJ7
	JNB	C3,AJ8
	MOV	AJ,#0DFH
	JNB	C0,AJ9
	JNB	C1,AJ0
	JNB	C2,DJ
	CLR	AXBZ
	RET
AJ1:	LCALL	SSCX
	MOV	AJBZ,#1
	SETB	AXBZ
	RET
AJ2:  	LCALL	SSCX
	MOV	AJBZ,#2
	SETB	AXBZ
	RET
AJ3:	LCALL	SSCX
	MOV	AJBZ,#3
	SETB	AXBZ
	RET
AJ4:	LCALL	SSCX
	MOV	AJBZ,#4
	SETB	AXBZ
	RET
AJ5:	LCALL	SSCX
	MOV	AJBZ,#5
	SETB	AXBZ
	RET
AJ6:	LCALL	SSCX
	MOV	AJBZ,#6
	SETB	AXBZ
	RET
AJ7:	LCALL	SSCX
	MOV	AJBZ,#7
	SETB	AXBZ
	RET
AJ8:	LCALL	SSCX
	MOV	AJBZ,#8
	SETB	AXBZ
	RET
AJ9:	LCALL	SSCX
	MOV	AJBZ,#9
	SETB	AXBZ
	RET
AJ0:	LCALL	SSCX
	MOV	AJBZ,#0
	SETB	AXBZ
	RET
DJ:	LCALL	SSCX
	SETB	DBZ
	MOV	SMBZ,#DS0
	RET

SSCX:	LCALL	SMQP
	MOV	AJ,#0FH
	JNB	C0,SSCX
	JNB	C1,SSCX
	JNB	C2,SSCX
	JNB	C3,SSCX
	RET

MY:	MOV	DPTR,#TAB
	MOV	R1,#DS0
	MOV	R2,#0FEH
MA:	MOV	A,@R1
	MOVC	A,@A+DPTR
	PUSH	ACC
	JNB	DBZ,MA1
	MOV	A,R1
	CJNE	A,SMBZ,MA1
	POP	ACC
	ANL	A,#7FH
	PUSH	ACC
MA1:	POP	ACC
	INC	R1
	MOV	SMG,A
	CLR	E
	CLR	CS1
	SETB	E
	SETB	CS1
	MOV	A,R2
	MOV	SMG,A
	RL	A
	MOV	R2,A
	CLR	E
	CLR	CS2
	SETB	E
	SETB	CS2
	LCALL	SMYS
	LCALL	SMQP
	CJNE	R1,#38H,MA
	RET
SMYS:	MOV	R3,#0FFH
	DJNZ	R3,$
	RET
SMQP:	MOV	SMG,#0FFH
	CLR	E
	CLR	CS1
	SETB	E
	SETB	CS1
	CLR	E
	CLR	CS2
	SETB	E
	SETB	CS2
	RET
TAB:DB	0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H,0FFH
	END