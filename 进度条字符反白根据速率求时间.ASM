EXTRN	CODE(LMDY,YS)
EXTRN	DATA(SW,GW,XS,SS,WW)

CS2	EQU	P2.0
CS1	EQU	P2.1
E	EQU	P2.2
RS	EQU	P2.3

XD	EQU	30H
YD	EQU	31H
ZS	EQU	32H
XJ	EQU	33H
TB1	EQU	34H
CSZJ	EQU	35H
CISHU	EQU	36H

XBZ	EQU	37H；或线标志
BZ	EQU	20H.2；反白标志

CC	EQU	38H；时间运算与显示单元

	ORG	00H
	AJMP	MAIN
	ORG	30H
MAIN:	MOV	SP,#80H
	CLR	XBZ
	CLR	FBBZ
	CLR	BZ
	LCALL	LCD_INIT
	LCALL	LMDY
	LCALL	YJCS
	LCALL	YJX
	LCALL	YJJD
MAI:	LCALL	YS05S；主程序
	LCALL	LMDY；C电压
	LCALL	YS；C运算进度
	MOV	A,SS；运算时间速率
	CLR	C	；
	SUBB	A,CC
	MOV	CC,A
	MOV	A,#100
	CLR	C
	SUBB	A,SS
	MOV	B,CC
	DIV	AB
	MOV	CC,A
	LCALL	YJSJ；时间显示
	LCALL	YJX1；进度条
	LCALL	YJJD；进度百分比
	LCALL	LMDY
	MOV	CC,SS
	MOV	A,SW
	CJNE	A,#0,MM1；进度是否为100，为则出去
	AJMP	MAI

MM1:	MOV	CC,#0
	LCALL	YJSJ
	AJMP	$

YS05S:	MOV	R5,#8；1S延时
YS1:	MOV	R6,#250
YS2:	MOV	R7,#250
	DJNZ	R7,$
	DJNZ	R6,YS2
	DJNZ	R5,YS1
	RET

YJSJ:	MOV	XD,#0BCH
	MOV	YD,#68H
	MOV	A,CC
	MOV	B,#10
	DIV	AB
	PUSH	B
	LCALL	YJGY2
	POP	B
	MOV	A,B
	LCALL	YJGY2
	MOV	A,#10
	LCALL	YJGY2
	RET

YJX1:	MOV	XD,#0BAH
	MOV	YD,#48H
	MOV	XJ,#2
	SETB	CS2
	CLR	CS1
	LCALL	QP1
	LCALL	YJX

	LCALL	YS
	MOV	XD,#0BAH
	MOV	YD,#48H
	LCALL	XIE
	MOV	CISHU,SS

YJ01:	MOV	A,#0FFH
	LCALL	XIESJ
	DJNZ	CISHU,YJ01

	MOV	XD,#0BBH
	MOV	YD,#48H
	LCALL	XIE
	MOV	CISHU,SS

YJ03:	MOV	A,#0FFH	
	LCALL	XIESJ
	DJNZ	CISHU,YJ03
	RET

YJX:	MOV	XD,#0BAH
	MOV	YD,#48H
YJ1:	LCALL	XIE
	MOV	CISHU,#56
YJ2:	MOV	A,#1
	LCALL	XIESJ
	DJNZ	CISHU,YJ2

	INC	XD
	MOV	YD,#48H
YJ3:	LCALL	XIE
	MOV	CISHU,#56
YJ4:	MOV	A,#80H
	LCALL	XIESJ
	DJNZ	CISHU,YJ4

	MOV	XD,#0BAH
	MOV	YD,#48H
	LCALL	XIE
	MOV	A,#0FFH
	LCALL	XIESJ
	INC	XD
	MOV	YD,#48H
	LCALL	XIE
	MOV	A,#0FFH
	LCALL	XIESJ

	MOV	XD,#0BAH
	MOV	YD,#7FH
	LCALL	XIE
	MOV	A,#0FFH
	LCALL	XIESJ
	INC	XD
	MOV	YD,#7FH
	LCALL	XIE
	MOV	A,#0FFH
	LCALL	XIESJ
	RET

YJJD:	SETB	BZ
	MOV	XD,#0BAH
	MOV	YD,#59H
	MOV	A,SW
	CJNE	A,#1,KK
	LCALL	YJGY4
KK:	MOV	A,GW
	LCALL	YJGY4
	MOV	A,XS
	LCALL	YJGY4
	MOV	A,#11
	LCALL	YJGY4
	CLR	BZ
	RET

YJCS:	MOV	DPTR,#TABCS
	MOV	XD,#0BAH
	MOV	YD,#40H
	MOV	ZS,#5
	LCALL	YJGY
	MOV	XD,#0BCH
	MOV	YD,#40H
	MOV	ZS,#7
	LCALL	YJGY
	RET

YJGY:	SETB	CS1
	CLR	CS2
YJGY1:	MOV	CISHU,#16
	LCALL	XIECX
	RET

YJGY4:	SETB	XBZ
	SETB	CS2
	CLR	CS1
YJGY5:	MOV	CISHU,#8
	MOV	ZS,#1
	MOV	B,#16
	MUL	AB
	MOV	TB1,A
	MOV	DPTR,#TABSZ
	LCALL	XIECX
	CLR	XBZ
	RET

YJGY2:	SETB	CS2
	CLR	CS1
YJGY3:	MOV	CISHU,#8
	MOV	ZS,#1
	MOV	B,#16
	MUL	AB
	MOV	TB1,A
	MOV	DPTR,#TABSZ
	LCALL	XIECX
	RET

XIECX:	MOV	A,#0C0H
	LCALL	XIEZL
TU1:	MOV	XJ,#2
TU2:	PUSH	YD
	MOV	CSZJ,CISHU
	CLR	20H.0
	LCALL	XIE
TU3:	MOV	A,TB1
	MOVC	A,@A+DPTR
	PUSH	ACC
	JNB	BZ,TU33
	MOV	A,YD
	CLR	C
	SUBB	A,#48H

	CLR	C
	SUBB	A,SS
	JNC	TU33
	POP	ACC
	CPL	A
	PUSH	ACC
TU33:	POP	ACC
	JNB	XBZ,TU4
	PUSH	ACC
	MOV	A,XJ
	CJNE	A,#2,TU31
	POP	ACC
	ORL	A,#1
	AJMP	TU4

TU31:	POP	ACC
	ORL	A,#80H
	AJMP	TU4

TU4:	LCALL	XIESJ
	INC	YD
	INC	DPTR
	LCALL	TU0
	DJNZ	CSZJ,TU3
	INC	XD
	LCALL	PDQF
	POP	YD
	DJNZ	XJ,TU2
	DEC	XD
	DEC	XD
	MOV	A,YD
	ADD	A,CISHU
	MOV	YD,A
	LCALL	TU0
	DJNZ	ZS,TU1
	MOV	TB1,#0
	RET

TU0:	MOV	A,YD
	CLR	C
	SUBB	A,#80H
	JC	TUC
	MOV	A,YD
	SUBB	A,#40H
	MOV	YD,A
	SETB	20H.0
	LCALL	PDQF
	LCALL	XIE
TUC:	RET

XIE:	MOV	A,XD
	LCALL	XIEZL
	MOV	A,YD
	LCALL	XIEZL
	RET

PDQF:	JNB	20H.0,TUC
	CPL	CS1
	CPL	CS2
	MOV	A,#0C0H
	LCALL	XIEZL
	RET
LCD_INIT:
	SETB	CS1
	SETB	CS2
	MOV	A,#3FH
	LCALL	XIEZL
	LCALL	QP
	RET

QP:	MOV	XJ,#8
	MOV	XD,#0B8H
QP1:	MOV	A,XD
	LCALL	XIEZL
	MOV	A,#40H
	LCALL	XIEZL	
	MOV	CISHU,#64
QP2:	MOV	A,#0H
	LCALL	XIESJ
	DJNZ	CISHU,QP2
	INC	XD
	DJNZ	XJ,QP1
	RET

XIEZL:	CLR	E
	CLR	RS
	MOV	P0,A
	SETB	E
	CLR	E
	RET

XIESJ:	CLR	E
	SETB	RS
	MOV	P0,A
	SETB	E
	CLR	E
	RET

TABCS:;--  文字:  加  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,008H,008H,008H,0FFH,008H,008H,0F8H,000H,0F8H,008H,008H,008H,0F8H,000H,000H
DB  040H,020H,018H,007H,000H,020H,040H,03FH,000H,07FH,010H,010H,010H,03FH,000H,000H

;--  文字:  工  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,000H,002H,002H,002H,002H,002H,0FEH,002H,002H,002H,002H,002H,002H,000H,000H
DB  020H,020H,020H,020H,020H,020H,020H,03FH,020H,020H,020H,020H,020H,020H,020H,000H

;--  文字:  进  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  080H,082H,09CH,088H,000H,088H,088H,0FFH,088H,088H,088H,0FFH,088H,088H,080H,000H
DB  000H,040H,020H,01FH,020H,050H,04CH,043H,040H,040H,040H,05FH,040H,040H,040H,000H

;--  文字:  度  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,000H,0FCH,004H,024H,024H,0FCH,0A5H,0A6H,0A4H,0FCH,024H,024H,024H,004H,000H
DB  080H,060H,01FH,080H,080H,042H,046H,02AH,012H,012H,02AH,026H,042H,0C0H,040H,000H

;--  文字:  ：  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H
DB  000H,000H,036H,036H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H

;--  文字:  预  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  020H,022H,02AH,0F2H,02AH,066H,020H,002H,0F2H,01AH,0D6H,012H,012H,0F2H,002H,000H
DB  000H,020H,040H,03FH,000H,000H,040H,040H,027H,018H,007H,008H,010H,027H,060H,000H

;--  文字:  计  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  020H,021H,02EH,0E4H,000H,000H,020H,020H,020H,020H,0FFH,020H,020H,020H,020H,000H
DB  000H,000H,000H,07FH,020H,010H,008H,000H,000H,000H,0FFH,000H,000H,000H,000H,000H

;--  文字:  加  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,008H,008H,008H,0FFH,008H,008H,0F8H,000H,0F8H,008H,008H,008H,0F8H,000H,000H
DB  040H,020H,018H,007H,000H,020H,040H,03FH,000H,07FH,010H,010H,010H,03FH,000H,000H

;--  文字:  工  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,000H,002H,002H,002H,002H,002H,0FEH,002H,002H,002H,002H,002H,002H,000H,000H
DB  020H,020H,020H,020H,020H,020H,020H,03FH,020H,020H,020H,020H,020H,020H,020H,000H

;--  文字:  时  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,0FCH,044H,044H,044H,0FCH,010H,090H,010H,010H,010H,0FFH,010H,010H,010H,000H
DB  000H,007H,004H,004H,004H,007H,000H,000H,003H,040H,080H,07FH,000H,000H,000H,000H

;--  文字:  间  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,0F8H,001H,006H,000H,0F0H,092H,092H,092H,092H,0F2H,002H,002H,0FEH,000H,000H
DB  000H,0FFH,000H,000H,000H,007H,004H,004H,004H,004H,007H,040H,080H,07FH,000H,000H

;--  文字:  ：  --
;--  宋体12;  此字体下对应的点阵为：宽x高=16x16   --
DB  000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H
DB  000H,000H,036H,036H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H,000H


TABSZ:;--  文字:  0  --
;--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --
DB  000H,0E0H,010H,008H,008H,010H,0E0H,000H,000H,00FH,010H,020H,020H,010H,00FH,000H

;--  文字:  1  --
;--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --
DB  000H,010H,010H,0F8H,000H,000H,000H,000H,000H,020H,020H,03FH,020H,020H,000H,000H

;--  文字:  2  --
;--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --
DB  000H,070H,008H,008H,008H,088H,070H,000H,000H,030H,028H,024H,022H,021H,030H,000H

;--  文字:  3  --
;--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --
DB  000H,030H,008H,088H,088H,048H,030H,000H,000H,018H,020H,020H,020H,011H,00EH,000H

;--  文字:  4  --
;--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --
DB  000H,000H,0C0H,020H,010H,0F8H,000H,000H,000H,007H,004H,024H,024H,03FH,024H,000H

;--  文字:  5  --
;--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --
DB  000H,0F8H,008H,088H,088H,008H,008H,000H,000H,019H,021H,020H,020H,011H,00EH,000H

;--  文字:  6  --
;--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --
DB  000H,0E0H,010H,088H,088H,018H,000H,000H,000H,00FH,011H,020H,020H,011H,00EH,000H

;--  文字:  7  --
;--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --
DB  000H,038H,008H,008H,0C8H,038H,008H,000H,000H,000H,000H,03FH,000H,000H,000H,000H

;--  文字:  8  --
;--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --
DB  000H,070H,088H,008H,008H,088H,070H,000H,000H,01CH,022H,021H,021H,022H,01CH,000H

;--  文字:  9  --
;--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --
DB  000H,0E0H,010H,008H,008H,010H,0E0H,000H,000H,000H,031H,022H,022H,011H,00FH,000H

;--  文字:  s  --
;--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --
DB  000H,000H,080H,080H,080H,080H,080H,000H,000H,033H,024H,024H,024H,024H,019H,000H
;--  文字:  %  --
;--  宋体12;  此字体下对应的点阵为：宽x高=8x16   --
DB  0F0H,008H,0F0H,000H,0E0H,018H,000H,000H,000H,021H,01CH,003H,01EH,021H,01EH,000H







	END
#include <reg52.h>
#define uint unsigned int
#define uchar unsigned char
#define DATA P0

uint wdu;
uchar sw,gw,xs,ss,ww;

sbit q=P1^0;

void	lmdy()
{

	uint i;
	DATA=0xff;		
	q=0;
	i=DATA;
	q=1;
	
	wdu=(uint)(100.0/255.0*i);
	sw=(uchar)(wdu/100);
	gw=(uchar)(wdu%100/10);
	xs=(uchar)(wdu%100%10/1);
	ww=(uchar)(sw*100+gw*10+xs);

}

void	ys()
{
	lmdy();
       ss=(uchar)(56.0/100.0*ww);

}

