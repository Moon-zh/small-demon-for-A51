CS1	EQU	P1.0
CS2	EQU	P1.1
E	EQU	P1.2
SMG	EQU	21H

DS0	EQU	30H
DS1	EQU	31H
DS2	EQU	32H
DS3	EQU	33H
DS4	EQU	34H
DS5	EQU	35H
DS6	EQU	36H
DS7	EQU	37H
WD1	EQU	38H
WD2	EQU	39H


	ORG	00H
	AJMP	MAIN
	ORG	30H

MAIN:	MOV	SP,#80H
	LCALL	INIT_8255
	MOV	DS7,#7
	MOV	DS6,#6
	MOV	DS5,#5
	MOV	DS4,#4
	MOV	21H,#0FFH
	LCALL	PDB
	LCALL	MY
MAI:	LCALL	MY
	AJMP	MAI

MY:	MOV	DPTR,#TAB
	MOV	R0,#4
	MOV	R1,#DS7
	MOV	R2,#7FH
MA:	MOV	A,@R1
	MOVC	A,@A+DPTR
	CJNE	R1,#DS6,M1
	ANL	A,#7FH
M1:	MOV	SMG,A
	LCALL	PDB
	DEC	R1
	CLR	E
	CLR	CS1
	SETB	E
	SETB	CS1
	MOV	A,R2
	MOV	SMG,A
	LCALL	PDB
	RR	A
	MOV	R2,A
	CLR	E
	CLR	CS2
	SETB	E
	SETB	CS2
	LCALL	SMYS
	LCALL	SMQP
	DJNZ	R0,MA
	RET

SMYS:	MOV	R7,#3
SM11:	MOV	R6,#0FFH
	DJNZ	R6,$
	DJNZ	R7,SM11
	RET

SMQP:	MOV	SMG,#0FFH
	LCALL	PDB
	CLR	E
	CLR	CS1
	SETB	E
	SETB	CS1
	CLR	E
	CLR	CS2
	SETB	E
	SETB	CS2
	RET

TAB:DB	0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H,0FFH

INIT_8255:
	LCALL	YS
	MOV	DPTR,#3FFH(p2.0 2.1/a0 a1)
	MOV	A,#91H
	MOVX	@DPTR,A
	RET
PDB:	PUSH	DPH
	PUSH	DPL
	MOV	A,21H
	MOV	DPTR,#1FFH
	MOVX	@DPTR,A
	POP	DPL
	POP	DPH
	RET
YS:	MOV	R5,#8
YS1:	MOV	R6,#250
YS2:	MOV	R7,#250
	DJNZ	R7,$
	DJNZ	R6,YS2
	DJNZ	R5,YS1
	RET
	END