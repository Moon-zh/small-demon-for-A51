光电检测白球  光线松开检测黄球，抓紧检测黑球，检测不到为无球

ZY	EQU	P1.0
YY	EQU	P1.1
ZJ	EQU	P1.2
SX	EQU	P1.3
GW1	EQU	P2.0
GW2	EQU	P2.1
GW3	EQU	P2.2
GD1	EQU	P2.3
GD2	EQU	P2.4
GX	EQU	P2.5
CG	EQU	P3.0(电感)
SMG	EQU	P0
DS0	EQU	30H
CS1	EQU	P3.1
CS2	EQU	P3.2
E	EQU	P3.3
SZ	EQU	P3.4(设置按键)
G1	EQU	31H(方式存储单元)
G2	EQU	32H
G3	EQU	33H
S1	EQU	34H(方式工作单元)
S2	EQU	35H
S3	EQU	36H
	ORG	00H
	AJMP	MAIN
	ORG	30H
MAIN:	MOV	SP,#80H
	MOV	DS0,#0
MAI:	LCALL	MY
	JNB	CG,CXKS
	JB	SZ,MAI
	JNB	SZ,$
	INC	DS0
	MOV	A,DS0
	CJNE	A,#4,MAI
	MOV	DS0,#0
	AJMP	MAI
CXKS:	LCALL	FW	(开始判断位置)
	JNB	GD1,CX1
	JNB	GD2,CX2
K1:	LCALL	YYX
	JB	GW2,K1
	SETB	YY
	LCALL	XYX
	LCALL	YS1S
	JB	GX,K2
	MOV	G1,#3
	MOV	G2,#2
	MOV	G3,#1
	AJMP	SBC
K2:	LCALL	ZJX
	LCALL	YS1S
	JB	GX,BJ
	MOV	G1,#2
	MOV	G2,#3
	MOV	G3,#1
	AJMP	SBC
CX1:	MOV	G1,#1
K3:	LCALL	YYX
	JB	GW2,K3
	SETB	YY
	LCALL	XYX
	LCALL	YS1S
	JB	GX,K4
	MOV	G2,#2
	MOV	G3,#3
	AJMP	SBC
K4:	LCALL	ZJX
	LCALL	YS1S
	JB	GX,BJ
	MOV	G2,#3
	MOV	G3,#2
	AJMP	SBC
CX2:	MOV	G2,#1
K5:	LCALL	YYX
	JB	GW1,K5
	SETB	YY
	LCALL	XYX
	LCALL	YS1S
	JB	GX,K6
	MOV	G1,#2
	MOV	G3,#3
	AJMP	SBC
K6:	LCALL	ZJX
	LCALL	YS1S
	JB	GX,BJ
	MOV	G1,#3
	MOV	G3,#2
	AJMP	SBC
BJ:	LCALL	SKX	(报警)
	CPL	P3.7
	JNB	GD1,BJC
	JNB	GD2,BJC
	LCALL	ZJX
	LCALL	YS1S
	JB	GX,BJ
BJC:	LCALL	FW
	AJMP	CXKS
SBC:	LCALL	FW	(开始分拣)
	MOV	A,DS0
	CJNE	A,#1,FJ1
	MOV	S1,#1
	MOV	S2,#2
	MOV	S3,#3
	AJMP	FJ
FJ1:	CJNE	A,#2,FJ2
	MOV	S1,#3
	MOV	S2,#2
	MOV	S3,#1
	AJMP	FJ
FJ2:
	MOV	S1,#2
	MOV	S2,#1
	MOV	S3,#3
	AJMP	FJ
FJ:	MOV	A,G1
	CJNE	A,S1,FJ3
	MOV	A,G2
	CJNE	A,S2,FJ4
	AJMP	FJC
FJ3:	LCALL	QGW1
	MOV	A,G1
	XCH	A,G3
	XCH	A,G2
	XCH	A,G1
	AJMP	FJ
FJ4:	LCALL	QGW2
	MOV	A,G2
	XCH	A,G3
	XCH	A,G2
	AJMP	FJ				
FJC:	AJMP	MAIN






QGW1:	LCALL	YYX
	JB	GW1,QGW1
	SETB	YY
	LCALL	FQCX
	RET
QGW2:	LCALL	YYX
	JB	GW2,QGW2
	SETB	YY
	LCALL	FQCX
	RET
FQCX:	LCALL	XYX
	LCALL	ZJX
	LCALL	SYX
FQ1:	LCALL	ZYX
	JB	GW3,FQ1
	SETB	ZY
	LCALL	SKX
	RET
FW:	LCALL	SKX
	LCALL	SYX
FW2:	JNB	GW3,FWC
	LCALL	YYX
	JNB	GW2,FW1
	JB	GW1,FW2
FW1:	SETB	YY
	LCALL	ZYX
	JB	GW3,FW1
FWC:	SETB	ZY
	SETB	YY
	RET
ZYX:	CLR	ZY
	SETB	YY
	LCALL	MY
	RET
YYX:	CLR	YY
	SETB	ZY
	LCALL	MY
	RET
ZJX:	CLR	ZJ
	RET
SKX:	SETB	ZJ
	RET
SYX:	SETB	SX
	LCALL	YS1S
	RET
XYX:	CLR	SX
	LCALL	YS1S
	RET
MY:	MOV	DPTR,#TAB
	MOV	R0,#8
	MOV	R1,#DS0
	MOV	R2,#0FEH
MA:	MOV	A,@R1
	MOVC	A,@A+DPTR
	INC	R1
	MOV	SMG,A
	CLR	E
	CLR	CS1
	SETB	E
	SETB	CS1
	MOV	A,R2
	MOV	SMG,A
	RL	A
	MOV	R2,A
	CLR	E
	CLR	CS2
	SETB	E
	SETB	CS2
	LCALL	SMYS
	LCALL	SMQP
	RET
SMYS:	MOV	R3,#30
SM11:	MOV	R4,#40
	DJNZ	R4,$
	DJNZ	R3,SM11
	RET
SMQP:	MOV	SMG,#0FFH
	CLR	E
	CLR	CS1
	SETB	E
	SETB	CS1
	CLR	E
	CLR	CS2
	SETB	E
	SETB	CS2
	RET
TAB:DB	0C0H,0F9H,0A4H,0B0H,99H,92H,82H,0F8H,80H,90H







YS1S:	MOV	R5,#8
YS1:	MOV	R6,#250
YS2:	MOV	R7,#250
	DJNZ	R7,$
	DJNZ	R6,YS2
	DJNZ	R5,YS1
	RET
	END